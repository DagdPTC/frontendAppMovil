<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orderly - Reservas</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/reservations.css" />
</head>

<body class="bg-gray-50 text-gray-800 font-sans">
  <div class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="sticky top-0 z-30 bg-blue-500 text-white shadow">
      <nav class="max-w-6xl mx-auto px-4 py-3">
        <div class="flex items-center gap-3">
          <i class="fas fa-calendar-alt text-xl md:text-2xl"></i>
          <h1 class="text-base md:text-lg font-semibold leading-none">Reservas</h1>
        </div>
      </nav>
    </header>

    <!-- Main Content -->
    <main class="flex-1">
      <div class="max-w-6xl mx-auto px-4 py-6">

        <!-- Botón Nueva Reserva -->
        <div id="button-section" class="flex justify-end mb-4">
          <button id="new-reservation-btn"
                  class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-sm transition-colors">
            <i class="fas fa-plus"></i>
            <span>Nueva Reserva</span>
          </button>
        </div>

        <!-- Lista de Reservas -->
        <section id="reservations-section" class="space-y-3">
          <!-- Se llena dinámicamente -->
        </section>

        <!-- Modal Formulario de Nueva/Editar Reserva -->
        <div id="new-reservation-form" class="hidden">
          <div class="modal-overlay" data-form-overlay="true"></div>
          <div class="modal-content bg-white rounded-xl shadow-2xl">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-5 py-4 rounded-t-xl z-10">
              <div class="flex items-center justify-between">
                <h2 id="reservation-form-title" class="text-lg md:text-xl font-semibold">Nueva reserva</h2>
                <button id="cancel-reservation-btn" 
                        class="text-blue-600 hover:text-blue-700 text-sm font-medium px-4 py-2 rounded-lg border border-blue-600 hover:bg-blue-50 transition-colors">
                  Cancelar
                </button>
              </div>
            </div>
            
            <div class="p-5">
          <div class="grid md:grid-cols-2 gap-4 mt-2">
            <!-- Cliente -->
            <div>
              <label for="client-name" class="block text-sm font-medium text-gray-700 mb-1">
                Cliente <span class="text-red-500">*</span>
              </label>
              <input id="client-name" 
                     type="text" 
                     placeholder="Nombre del Cliente"
                     class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 transition" />
              <p id="client-error" class="hidden text-red-600 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>Ingrese el nombre del cliente.
              </p>
            </div>

            <!-- Teléfono -->
            <div>
              <label for="client-phone" class="block text-sm font-medium text-gray-700 mb-1">
                Teléfono <span class="text-red-500">*</span>
              </label>
              <input id="client-phone" 
                     type="tel" 
                     placeholder="7777-8889"
                     class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 transition" />
              <p id="phone-error" class="hidden text-red-600 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>Teléfono inválido (8 dígitos).
              </p>
            </div>

            <!-- Fecha -->
            <div>
              <label for="reservation-date" class="block text-sm font-medium text-gray-700 mb-1">
                Fecha <span class="text-red-500">*</span>
              </label>
              <input id="reservation-date" 
                     type="date"
                     class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 transition" />
              <p id="date-error" class="hidden text-red-600 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>Ingrese una fecha.
              </p>
            </div>

            <!-- Hora Inicio -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                Hora Inicio <span class="text-red-500">*</span>
              </label>
              <div class="flex gap-2">
                <input id="reservation-time-start" 
                       type="text" 
                       inputmode="numeric" 
                       placeholder="08:00"
                       class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 transition" />
                <select id="reservation-time-start-ampm"
                        class="w-24 p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 transition">
                  <option>AM</option>
                  <option>PM</option>
                </select>
              </div>
              <p id="time-start-error" class="hidden text-red-600 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>Hora inválida.
              </p>
            </div>

            <!-- Hora Fin -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                Hora Fin <span class="text-red-500">*</span>
              </label>
              <div class="flex gap-2">
                <input id="reservation-time-end" 
                       type="text" 
                       inputmode="numeric" 
                       placeholder="10:00"
                       class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 transition" />
                <select id="reservation-time-end-ampm"
                        class="w-24 p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 transition">
                  <option>AM</option>
                  <option>PM</option>
                </select>
              </div>
              <p id="time-end-error" class="hidden text-red-600 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>La hora fin debe ser posterior.
              </p>
            </div>

            <!-- Personas -->
            <div>
              <label for="reservation-people" class="block text-sm font-medium text-gray-700 mb-1">
                Personas <span class="text-red-500">*</span>
              </label>
              <input id="reservation-people" 
                     type="number" 
                     min="1" 
                     max="200"
                     placeholder="2"
                     class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 transition" />
              <p id="people-error" class="hidden text-red-600 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>Ingrese la cantidad (1–200).
              </p>
            </div>

            <!-- Tipo de Evento -->
            <div>
              <label for="reservation-event" class="block text-sm font-medium text-gray-700 mb-1">
                Tipo de Evento <span class="text-red-500">*</span>
              </label>
              <select id="reservation-event"
                      class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 transition">
                <option value="">Cargando…</option>
              </select>
              <p id="event-error" class="hidden text-red-600 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>Seleccione un tipo de evento.
              </p>
            </div>

            <!-- Mesas -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-1">
                Mesas <span class="text-red-500">*</span>
              </label>
              <button id="select-tables-btn" 
                      type="button"
                      class="w-full border-2 border-dashed border-gray-300 rounded-lg py-3 text-gray-600 hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50 transition-all">
                <i class="fas fa-chair mr-2"></i>Seleccionar Mesas
              </button>
              <p id="selected-tables-text" class="text-sm text-gray-600 mt-1">
                Ninguna mesa seleccionada.
              </p>
              <p id="tables-error" class="hidden text-red-600 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>Seleccione al menos una mesa.
              </p>
            </div>

            <!-- Comentarios -->
            <div class="md:col-span-2">
              <label for="reservation-comment" class="block text-sm font-medium text-gray-700 mb-1">
                Comentarios (Opcional)
              </label>
              <textarea id="reservation-comment" 
                        rows="3" 
                        maxlength="500"
                        placeholder="Ej: Cliente prefiere mesa cerca de la ventana, tiene alergia a mariscos..."
                        class="w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 resize-y transition"></textarea>
              <p class="text-xs text-gray-500 mt-1">
                <i class="fas fa-info-circle mr-1"></i>Información adicional sobre la reserva (máx. 500 caracteres)
              </p>
            </div>
          </div>

          <!-- Botón Guardar -->
          <div class="mt-5 sticky bottom-0 bg-white pt-4 border-t border-gray-200">
            <button id="save-reservation-btn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium shadow-sm transition-colors">
              <i class="fas fa-save mr-2"></i>Guardar Reserva
            </button>
          </div>
        </div>
      </div>
    </div>

      </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="sticky bottom-0 z-20 bg-white border-t border-gray-200 shadow-sm">
      <div class="max-w-6xl mx-auto px-2">
        <ul class="flex justify-around py-3">
          <li>
            <a href="index.html" class="flex flex-col items-center text-xs text-gray-500 hover:text-gray-700 transition-colors">
              <i class="fas fa-home text-lg mb-1"></i>
              <span>Inicio</span>
            </a>
          </li>
          <li>
            <a href="tables.html" class="flex flex-col items-center text-xs text-gray-500 hover:text-gray-700 transition-colors">
              <i class="fas fa-chair text-lg mb-1"></i>
              <span>Mesas</span>
            </a>
          </li>
          <li>
            <a href="orders.html" class="flex flex-col items-center text-xs text-gray-500 hover:text-gray-700 transition-colors">
              <i class="fas fa-clipboard-list text-lg mb-1"></i>
              <span>Pedidos</span>
            </a>
          </li>
          <li>
            <a href="reservations.html" class="flex flex-col items-center text-xs text-blue-600">
              <i class="fas fa-calendar-alt text-lg mb-1"></i>
              <span>Reservas</span>
            </a>
          </li>
          <li>
            <a href="menu.html" class="flex flex-col items-center text-xs text-gray-500 hover:text-gray-700 transition-colors">
              <i class="fas fa-utensils text-lg mb-1"></i>
              <span>Menú</span>
            </a>
          </li>
        </ul>
      </div>
    </nav>
  </div>

  <!-- MODAL Mesas CON DISPONIBILIDAD EN TIEMPO REAL -->
  <div id="tables-modal" class="fixed inset-0 z-[10000] hidden">
    <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" data-overlay="true"></div>
    <div class="relative z-10 max-w-md mx-auto my-6 bg-white rounded-xl shadow-2xl max-h-[90vh] flex flex-col">
      
      <!-- Header del Modal -->
      <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-5 py-4 flex-shrink-0 rounded-t-xl">
        <div class="flex justify-between items-center">
          <div class="flex items-center gap-2 text-white">
            <i class="fas fa-chair text-xl"></i>
            <h3 class="font-semibold text-lg">Seleccionar Mesas</h3>
          </div>
          <div class="flex items-center gap-2">
            <button id="refresh-tables-btn" 
                    class="text-white hover:bg-white/20 p-2 rounded-lg transition-colors"
                    title="Actualizar disponibilidad">
              <i class="fas fa-sync-alt"></i>
            </button>
            <button id="close-tables-modal" 
                    class="text-white hover:bg-white/20 text-2xl leading-none p-2 rounded-lg transition-colors">
              &times;
            </button>
          </div>
        </div>
      </div>

      <!-- NUEVO: Info de Fecha/Hora Seleccionada -->
      <div id="date-warning" class="px-5 py-3 bg-blue-50 border-b border-blue-100 flex-shrink-0">
        <div class="flex items-center gap-2 text-sm text-blue-700">
          <i class="fas fa-calendar-check"></i>
          <span>Verificando disponibilidad...</span>
        </div>
      </div>

      <!-- Info de Actualización Automática -->
      <div class="px-5 py-2 bg-green-50 border-b border-green-100 flex-shrink-0">
        <div class="flex items-center gap-2 text-xs text-green-700">
          <i class="fas fa-sync-alt fa-spin"></i>
          <span>Actualización automática cada 5 segundos</span>
        </div>
      </div>
      
      <!-- Contenedor con Scroll -->
      <div class="flex-1 overflow-y-auto p-5">
        <!-- Grid de Mesas -->
        <div id="tables-grid" class="grid grid-cols-3 gap-3 mb-4">
          <!-- Mesas se cargan dinámicamente -->
        </div>

        <!-- Info de Mesas Seleccionadas -->
        <div id="mesas-info" class="mb-4 p-3 bg-gray-50 rounded-lg border border-gray-200">
          <p class="text-sm text-gray-500">Selecciona al menos una mesa</p>
        </div>
      </div>
      
      <!-- Footer con Botones -->
      <div class="flex justify-end gap-2 px-5 py-4 bg-gray-50 border-t flex-shrink-0 rounded-b-xl">
        <button id="cancel-tables-btn" 
                class="px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors">
          Cancelar
        </button>
        <button id="save-tables-btn" 
                class="px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
          <i class="fas fa-check mr-1"></i>Confirmar Selección
        </button>
      </div>
    </div>
  </div>

  <!-- Script: Controller -->
  <script type="module" src="js/controllers/reservaController.js"></script>
</body>
</html>